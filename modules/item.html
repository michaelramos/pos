<div name="item" title="ITEMS" presenter="item_presenter" description="Item Module" color="#46B6AC">
	<menu action="newItem" enable="">New</menu>
	<menu action="syncItems" enable="">Sync</menu>
	<content>
		<div class="mdl-grid pos-item-grid">
			<div partial-view="pos-item-view" class="mdl-cell mdl-cell--4-col" style="display: none">
				<div class="demo-card-square mdl-card mdl-shadow--2dp">
					<div class="mdl-card__title mdl-card--expand" style="background-color: #46B6AC">
						<h4 class="item-display-name">Chicken Wings</h4>
					</div>
					<div class="mdl-card__supporting-text item-display-price" style="font-weight: bolder">
						Php 15.00
					</div>
					<div class="mdl-card__actions mdl-card--border">
						<a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect action">Open</a>
					</div>
				</div>
			</div>
		</div>
	</content>
	<script type="application/javascript">
		Platform.presenter('item_presenter', {
			init: function(navigator) {
				$('[menu-action="newItem"].platform-context-menu').click(function(){
					Platform.load('item-view');
				});
			
				$('.pos-item-grid').html('');
				$('#platform-title').text("ITEMS");
				
				this.list().done(function(items) {
					$.each(items, function(){
						var item = this;
						var view = MVVM.partial('pos-item-view');
						
						view.find('.item-display-name').text(item.name);
						view.find('.item-display-price').text('Php ' + parseFloat(item.price).currency());
						view.find('.demo-card-square > .mdl-card__title').css('background-color', window.randomColors());
						view.find('a.action').click(function(){
							Platform.load('item-view', item);
						});
						
						$('.pos-item-grid').append(view);
						view.show('slow');
					});
				});
			},
			
			list: function() {
				var deferred = $.Deferred();
				POSDB.transaction(function(repo){
					var itemDao = repo.lookup('pos_item');
					itemDao.list().results(function(rows){	
						var list = [];
						for(var i=0; i < rows.length; i++)
							list.push(rows.item(i));
						
						deferred.resolve(list);
					});
				});
				return deferred.promise();
			},
			
			open: function () {
				
			}
		});
	</script>
</div>